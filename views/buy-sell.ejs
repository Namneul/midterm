<% layout('layout') -%>

<div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-800"><%= title %></h1>
    <a href="/community/buy-sell/new" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700">
        <svg class="-ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
        새 글 작성하기
    </a>
</div>

<div class="bg-white shadow overflow-hidden rounded-md">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
        <tr>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">분류</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">제목</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">가격</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">작성자</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">작성일</th>
        </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
        <% if (posts.length > 0) { %>
            <% posts.forEach(post => { %>
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <% if (post.postType === 'sell') { %><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">팝니다</span><% } else { %><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">삽니다</span><% } %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                        <a href="/community/buy-sell/<%= post._id %>" class="text-indigo-600 hover:text-indigo-900 hover:underline">
                            <%= post.title %>
                            <span class="text-gray-500 text-xs ml-1">[<%= post.comments.length %>]</span>
                        </a>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-semibold"><%= post.price.toLocaleString() %> 원</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <%= post.authorNickname %>
                        <span class="text-purple-600 font-medium">(<%= post.authorReputation %>점)</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><%= new Date(post.createdAt).toLocaleDateString() %></td>
                </tr>
            <% }) %>
        <% } else { %>
            <tr>
                <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">작성된 글이 없습니다.</td>
            </tr>
        <% } %>
        </tbody>
    </table>
</div>

<%# 페이지네이션 (Tailwind) %>
<% if (totalPages > 1) { %>
    <nav class="mt-6 flex justify-center" aria-label="Page navigation">
        <ul class="flex items-center -space-x-px h-8 text-sm">
            <li><a href="/community/buy-sell?page=<%= currentPage - 1 %>" class="flex items-center justify-center px-3 h-8 ms-0 leading-tight text-gray-500 bg-white border border-e-0 border-gray-300 rounded-s-lg hover:bg-gray-100 hover:text-gray-700 <%= currentPage <= 1 ? 'pointer-events-none opacity-50' : '' %>"><svg class="w-2.5 h-2.5 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 1 1 5l4 4"/></svg></a></li>
            <% const maxPagesToShow = 5; let startPage = Math.max(1, currentPage - Math.floor(maxPagesToShow / 2)); let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1); if (endPage - startPage + 1 < maxPagesToShow) { startPage = Math.max(1, endPage - maxPagesToShow + 1); } %>
            <% for (let i = startPage; i <= endPage; i++) { %>
                <li><a href="/community/buy-sell?page=<%= i %>" class="flex items-center justify-center px-3 h-8 leading-tight border border-gray-300 <%= i === currentPage ? 'text-indigo-600 bg-indigo-50 hover:bg-indigo-100 hover:text-indigo-700 font-semibold' : 'text-gray-500 bg-white hover:bg-gray-100 hover:text-gray-700' %>"><%= i %></a></li>
            <% } %>
            <li><a href="/community/buy-sell?page=<%= currentPage + 1 %>" class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 rounded-e-lg hover:bg-gray-100 hover:text-gray-700 <%= currentPage >= totalPages ? 'pointer-events-none opacity-50' : '' %>"><svg class="w-2.5 h-2.5 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/></svg></a></li>
        </ul>
    </nav>
<% } %>
