<% layout('layout') -%>

<h1 class="text-2xl font-bold text-gray-800 mb-6"><%= title %></h1>
<p class="text-sm text-gray-600 mb-6">JPG, PNG, GIF 형식의 이미지 파일 (최대 5MB)만 업로드 가능합니다.</p>

<form action="/profile/avatar/upload?_method=PUT" method="POST" enctype="multipart/form-data" class="max-w-md space-y-4">

    <%# 현재 프로필 사진 미리보기 %>
    <div class="mb-4">
        <p class="block text-sm font-medium text-gray-700 mb-1">현재 프로필 사진</p>
        <%# ⭐️ [수정] currentUser 존재 여부 먼저 확인 %>
        <% if (typeof currentUser !== 'undefined' && currentUser && currentUser.profileImagePath) { %>
            <% const filename = currentUser.profileImagePath.split('/').pop(); %>
            <img src="/profile/avatar/<%= filename %>" alt="Current Profile Picture" class="h-24 w-24 rounded-full object-cover border border-gray-300 shadow-sm">
        <% } else { %>
            <%# 기본 아바타 SVG %>
            <span class="inline-block h-24 w-24 rounded-full overflow-hidden bg-gray-100 border border-gray-300">
                 <svg class="h-full w-full text-gray-300" fill="currentColor" viewBox="0 0 24 24">
                   <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                 </svg>
             </span>
        <% } %>
    </div>

    <%# 파일 선택 input %>
    <div>
        <label for="profileImage" class="block text-sm font-medium text-gray-700">새 프로필 사진 선택</label>
        <div class="mt-1">
            <input type="file" name="profileImage" id="profileImage" required accept="image/jpeg, image/png, image/gif"
                   class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
        </div>
    </div>

    <%# 버튼 %>
    <div class="flex items-center space-x-3 pt-2">
        <button type="submit"
                class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700">
            사진 변경하기
        </button>
        <a href="/profile"
           class="inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
            취소
        </a>
    </div>
</form>