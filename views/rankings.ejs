<% layout('layout') -%>

<%# 온도 계산 함수 (profile.ejs, auction-detail.ejs와 동일) %>
<%
function calculateTemperatureStyle(score) {
    let temp = 36.5 + (score / 10);
    temp = Math.max(30.0, Math.min(temp, 42.0)).toFixed(1);
    let colorClass = 'text-gray-600 bg-gray-100 border-gray-300'; let emoji = '🙂';
    if (temp >= 40.0) { colorClass = 'text-red-700 bg-red-100 border-red-300'; emoji = '🥵'; }
    else if (temp >= 38.0) { colorClass = 'text-orange-700 bg-orange-100 border-orange-300'; emoji = '😊'; }
    else if (temp >= 36.5) { colorClass = 'text-green-700 bg-green-100 border-green-300'; emoji = '🙂'; }
    else if (temp >= 33.0) { colorClass = 'text-blue-700 bg-blue-100 border-blue-300'; emoji = '😐'; }
    else { colorClass = 'text-blue-900 bg-blue-200 border-blue-400'; emoji = '🥶'; }
    return { temp, colorClass, emoji };
}
%>

<h1 class="text-2xl font-bold text-gray-800 mb-2"><%= title %></h1>
<p class="text-sm text-gray-600 mb-6">가장 높은 평판 점수를 가진 사용자 순위입니다.</p>

<div class="bg-white shadow overflow-hidden rounded-md border border-gray-200">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
        <tr>
            <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-16">순위</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">닉네임</th>
            <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">매너 온도</th>
            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">평판 점수</th>
        </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
        <% if (topUsers.length > 0) { %>
            <% topUsers.forEach((user, index) => { %>
                <% const rank = index + 1; %>
                <% const tempStyle = calculateTemperatureStyle(user.reputation_score); %>
                <tr class="<%= rank <= 3 ? 'bg-yellow-50' : '' %>"> <%# 1~3위 강조 %>
                    <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-semibold <%= rank <= 3 ? 'text-yellow-700' : 'text-gray-900' %>">
                        <% if (rank === 1) { %>🥇<% } else if (rank === 2) { %>🥈<% } else if (rank === 3) { %>🥉<% } else { %><%= rank %><% } %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                        <%= user.anonymous_nickname %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold border <%= tempStyle.colorClass %>">
                                <%= tempStyle.emoji %> <%= tempStyle.temp %>°C
                            </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-semibold text-indigo-600">
                        <%= user.reputation_score %> 점
                    </td>
                </tr>
            <% }) %>
        <% } else { %>
            <tr>
                <td colspan="4" class="px-6 py-4 text-center text-sm text-gray-500">아직 랭킹 데이터가 없습니다.</td>
            </tr>
        <% } %>
        </tbody>
    </table>
</div>